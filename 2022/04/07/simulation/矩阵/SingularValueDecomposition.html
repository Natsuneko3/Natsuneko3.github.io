<hr />
<p>title: 奇异值分解<br />
 date: 2023-10-16 12:00<br />
tags:</p>
<ul>
<li>模拟</li>
<li>笔记</li>
<li>矩阵<br />
 category: 模拟笔记<br />
 count: true</li>
</ul>
<hr />
<h1 id="奇异值分解"><a class="anchor" href="#奇异值分解">#</a> 奇异值分解</h1>
<h1 id="特征值和特征向量"><a class="anchor" href="#特征值和特征向量">#</a> 特征值和特征向量</h1>
<p>特征值和特征向量的定义如下</p>
<p>𝐴𝑥=𝜆𝑥</p>
<p>其中 A 是一个𝑛×𝑛的实对称矩阵，𝑥是一个𝑛维向量，则我们说𝜆是矩阵 A 的一个特征值，而𝑥是矩阵 A 的特征值𝜆所对应的特征向量。</p>
<h1 id="svd定义"><a class="anchor" href="#svd定义">#</a> SVD 定义</h1>
<p>D 也是对矩阵进行分解，但是和特征分解不同，SVD 并不要求要分解的矩阵为方阵。假设我们的矩阵 A 是一个𝑚×𝑛的矩阵，那么我们定义矩阵 A 的 SVD 为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>=</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">A = U\Sigma V^T
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中 U 是一个𝑚×𝑚的矩阵，Σ 是一个𝑚×𝑛的矩阵，除了主对角线上的元素以外全为 0，主对角线上的每个元素都称为奇异值，V 是一个𝑛×𝑛的矩阵。U 和 V 都是酉矩阵，即满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>U</mi><mi>T</mi></msup><mi>U</mi><mo>=</mo><mi>I</mi><mo separator="true">,</mo><msup><mi>V</mi><mi>T</mi></msup><mi>V</mi><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">U^TU = I,V^TV = I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></p>
<p><img src="Untitled.png" alt="Untitled" /></p>
<p>如果我们将 A 的转置和 A 做矩阵乘法，那么会得到𝑛×𝑛的一个方阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">A^TA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span>。既然<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">A^TA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> 是方阵，那么我们就可以进行特征分解，得到的特征值和特征向量</p>
(𝐴^𝑇𝐴)𝑣_𝑖=𝜆_𝑖𝑣_𝑖

<p>这样我们就可以得到矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">A^TA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> 的 n 个特征值和对应的 n 个特征向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> 了。将<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">A^TA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> 的所有特征向量张成一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> 的矩阵 V，那么<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><msup><mi>A</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">AA^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> 就是的所有特征向量就是矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span>，</p>
<p><img src="Untitled%201.png" alt="Untitled" /></p>
<p>也就说 sig 矩阵可以用𝐴𝑣_𝑖=𝜎_𝑖u_i 𝜎_𝑖就是奇异值</p>
<p><img src="Untitled%202.png" alt="Untitled" /></p>
<p>其中 SVD 的物理含义就是</p>
<p><img src="Untitled%203.png" alt="Untitled" /></p>
<p>这就表明任意的矩阵 A 是可以分解成三个矩阵相乘的形式。<strong>V</strong> 表示了原始域的标准正交基，<strong>U</strong> 表示经过 A 变换后的 co-domain 的标准正交基，Σ 表示了<strong> V</strong> 中的向量与<strong> U</strong> 中相对应向量之间的关系。我们仔细观察上图发现，线性变换 A 可以分解为<strong>旋转</strong>、<strong>缩放</strong>、<strong>旋转</strong>这三种基本线性变换。</p>
<p>sig 是对角阵，表示奇异值，A 矩阵的作用是将一个向量在 V 这组正交基向量的空间<strong>旋转，<strong>并对每个方向进行了一定的</strong>缩放</strong>，缩放因子就是各个奇异值。然后在 U 这组正交基向量的空间再次<strong>旋转</strong>。可以说奇异值分解将一个矩阵原本混合在一起的三种作用效果，分解出来了。</p>
<h1 id="svd应用"><a class="anchor" href="#svd应用">#</a> SVD 应用</h1>
<p>接下来我们从分解的角度重新理解前面的表达式，我们把原来的矩阵<em> A</em> 表达成了<em> n</em> 个矩阵的和：</p>
<p><img src="Untitled%204.png" alt="Untitled" /></p>
<p>其中奇异值就是每个矩阵的权重，越往前的比例越大。</p>
<p>我们用一个图像压缩的例子来说明。我们知道，电脑上的图像（特指位图）都是由像素点组成的，所以存储一张 1000×622 大小的图片，实际上就是存储一个 1000×622 的矩阵，共 622000 个元素。这个矩阵用 SVD 可以分解为 622 个矩阵之和，如果我们选取其中的前 100 个之和作为对图像数据的近似，那么只需要存储 100 个奇异值，100 个向量和 100 个向量，共计 100×(1+1000+622)=162300 个元素，大约只有原始的 26% 大小。</p>
<h1 id="解svd"><a class="anchor" href="#解svd">#</a> 解 SVD</h1>
<p>其中解 SVD 有几种办法</p>
<figure class="highlight glsl"><figcaption data-lang="GLSL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Functions</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token comment">// -----------------------------</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	</pre></td></tr><tr><td data-num="5"></td><td><pre>		</pre></td></tr><tr><td data-num="6"></td><td><pre>	float3 <span class="token function">randomUnitVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		float3 unnormalized<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>			unnormalized<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">RandBBSfloat</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>			</pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token keyword">return</span> unnormalized<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	float3 <span class="token function">svd_1d</span><span class="token punctuation">(</span>float3x3 A<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token keyword">float</span> epsilon <span class="token operator">=</span> <span class="token number">1e-10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>		float3 x <span class="token operator">=</span> <span class="token function">randomUnitVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		float3 lastV <span class="token operator">=</span> <span class="token function">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		float3 currentV <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>			</pre></td></tr><tr><td data-num="27"></td><td><pre>		float3x3 B <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> <span class="token function">transpose</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			</pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>			lastV <span class="token operator">=</span> currentV<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>			currentV <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> lastV<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>			currentV <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>currentV<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>currentV<span class="token punctuation">,</span> lastV<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">-</span> epsilon<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>				<span class="token comment">// converged</span></pre></td></tr><tr><td data-num="38"></td><td><pre>				<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>		<span class="token keyword">return</span> currentV<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>		</pre></td></tr><tr><td data-num="43"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">svd</span><span class="token punctuation">(</span>float3x3 A<span class="token punctuation">,</span> <span class="token keyword">out</span> float3x3 us<span class="token punctuation">,</span><span class="token keyword">out</span> float3 singularValues<span class="token punctuation">,</span>  <span class="token keyword">out</span> float3x3 vs <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>		</pre></td></tr><tr><td data-num="48"></td><td><pre>	</pre></td></tr><tr><td data-num="49"></td><td><pre>		float3 u<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>		float3 v<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>	    </pre></td></tr><tr><td data-num="52"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>			float3x3 matrixFor1D <span class="token operator">=</span> A<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>					</pre></td></tr><tr><td data-num="59"></td><td><pre>				u <span class="token operator">=</span> us<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>				v <span class="token operator">=</span> vs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>				float3x3 OuterProduct <span class="token operator">=</span> <span class="token function">float3x3</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>x <span class="token operator">*</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> u<span class="token punctuation">.</span>x <span class="token operator">*</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> u<span class="token punctuation">.</span>x <span class="token operator">*</span> v<span class="token punctuation">.</span>z<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>					u<span class="token punctuation">.</span>y <span class="token operator">*</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> u<span class="token punctuation">.</span>y <span class="token operator">*</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> u<span class="token punctuation">.</span>y <span class="token operator">*</span> v<span class="token punctuation">.</span>z<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="63"></td><td><pre>					u<span class="token punctuation">.</span>z <span class="token operator">*</span> v<span class="token punctuation">.</span>x<span class="token punctuation">,</span> u<span class="token punctuation">.</span>z <span class="token operator">*</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> u<span class="token punctuation">.</span>z <span class="token operator">*</span> v<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>					</pre></td></tr><tr><td data-num="65"></td><td><pre>				matrixFor1D <span class="token operator">-=</span> singularValues<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> OuterProduct<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre>			float3 u <span class="token operator">=</span> <span class="token function">svd_1d</span><span class="token punctuation">(</span>matrixFor1D<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>			float3 v_unnormalized <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>			<span class="token keyword">float</span> sigma <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>v_unnormalized<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>			float3 v <span class="token operator">=</span> v_unnormalized <span class="token operator">/</span> sigma<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>				</pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>			singularValues<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sigma<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>			us<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>			vs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">ConverMatrix</span><span class="token punctuation">(</span>float3x3 Inmat<span class="token punctuation">,</span> <span class="token keyword">out</span> float4x4 OutMat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>		OutMat <span class="token operator">=</span>  <span class="token function">float4x4</span><span class="token punctuation">(</span>Inmat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="82"></td><td><pre>			Inmat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="83"></td><td><pre>			Inmat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="84"></td><td><pre>			<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>		</pre></td></tr><tr><td data-num="86"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>	<span class="token keyword">void</span> <span class="token function">ConverMatrix</span><span class="token punctuation">(</span>float4x4 Inmat<span class="token punctuation">,</span><span class="token keyword">out</span> float3x3 OutMat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>		OutMat <span class="token operator">=</span>  <span class="token function">float3x3</span><span class="token punctuation">(</span>Inmat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="90"></td><td><pre>			Inmat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="91"></td><td><pre>			Inmat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>Inmat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>	</pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> numpy<span class="token punctuation">.</span>linalg <span class="token keyword">import</span> norm</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> random <span class="token keyword">import</span> normalvariate</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">randomUnitVector</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    unnormalized <span class="token operator">=</span> <span class="token punctuation">[</span>normalvariate<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    theNorm <span class="token operator">=</span> sqrt<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> unnormalized<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">[</span>x <span class="token operator">/</span> theNorm <span class="token keyword">for</span> x <span class="token keyword">in</span> unnormalized<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">def</span> <span class="token function">svd_1d</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> epsilon<span class="token operator">=</span><span class="token number">1e-10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token triple-quoted-string string">''' The one-dimensional SVD '''</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    n<span class="token punctuation">,</span> m <span class="token operator">=</span> A<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="17"></td><td><pre>    x <span class="token operator">=</span> randomUnitVector<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    lastV <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    currentV <span class="token operator">=</span> x</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">if</span> n <span class="token operator">></span> m<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        B <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>A<span class="token punctuation">.</span>T<span class="token punctuation">,</span> A<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        B <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>A<span class="token punctuation">,</span> A<span class="token punctuation">.</span>T<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    iterations <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        iterations <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        lastV <span class="token operator">=</span> currentV</pre></td></tr><tr><td data-num="30"></td><td><pre>        currentV <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>B<span class="token punctuation">,</span> lastV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        currentV <span class="token operator">=</span> currentV <span class="token operator">/</span> norm<span class="token punctuation">(</span>currentV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>currentV<span class="token punctuation">,</span> lastV<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">-</span> epsilon<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"converged in &#123;&#125; iterations!"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>iterations<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">return</span> currentV</pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">def</span> <span class="token function">svd</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> epsilon<span class="token operator">=</span><span class="token number">1e-10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token triple-quoted-string string">'''</pre></td></tr><tr><td data-num="39"></td><td><pre>        Compute the singular value decomposition of a matrix A</pre></td></tr><tr><td data-num="40"></td><td><pre>        using the power method. A is the input matrix, and k</pre></td></tr><tr><td data-num="41"></td><td><pre>        is the number of singular values you wish to compute.</pre></td></tr><tr><td data-num="42"></td><td><pre>        If k is None, this computes the full-rank decomposition.</pre></td></tr><tr><td data-num="43"></td><td><pre>    '''</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    A <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>A<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    n<span class="token punctuation">,</span> m <span class="token operator">=</span> A<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="46"></td><td><pre>    svdSoFar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">if</span> k <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        matrixFor1D <span class="token operator">=</span> A<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">for</span> singularValue<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v <span class="token keyword">in</span> svdSoFar<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>            matrixFor1D <span class="token operator">-=</span> singularValue <span class="token operator">*</span> np<span class="token punctuation">.</span>outer<span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">if</span> n <span class="token operator">></span> m<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            v <span class="token operator">=</span> svd_1d<span class="token punctuation">(</span>matrixFor1D<span class="token punctuation">,</span> epsilon<span class="token operator">=</span>epsilon<span class="token punctuation">)</span>  <span class="token comment"># next singular vector</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            u_unnormalized <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>A<span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            sigma <span class="token operator">=</span> norm<span class="token punctuation">(</span>u_unnormalized<span class="token punctuation">)</span>  <span class="token comment"># next singular value</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            u <span class="token operator">=</span> u_unnormalized <span class="token operator">/</span> sigma</pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            u <span class="token operator">=</span> svd_1d<span class="token punctuation">(</span>matrixFor1D<span class="token punctuation">,</span> epsilon<span class="token operator">=</span>epsilon<span class="token punctuation">)</span>  <span class="token comment"># next singular vector</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            v_unnormalized <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>A<span class="token punctuation">.</span>T<span class="token punctuation">,</span> u<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            sigma <span class="token operator">=</span> norm<span class="token punctuation">(</span>v_unnormalized<span class="token punctuation">)</span>  <span class="token comment"># next singular value</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            v <span class="token operator">=</span> v_unnormalized <span class="token operator">/</span> sigma</pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre>        svdSoFar<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>    singularValues<span class="token punctuation">,</span> us<span class="token punctuation">,</span> vs <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>svdSoFar<span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token keyword">return</span> singularValues<span class="token punctuation">,</span> us<span class="token punctuation">.</span>T<span class="token punctuation">,</span> vs</pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token keyword">def</span> <span class="token function">QR_HouseHolder</span><span class="token punctuation">(</span>mat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    cols <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre>    Q <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    R <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        a <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>R<span class="token punctuation">[</span>col<span class="token punctuation">:</span><span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        e <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>cols <span class="token operator">-</span> col<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        num <span class="token operator">=</span> R<span class="token punctuation">[</span>col<span class="token punctuation">:</span><span class="token punctuation">,</span> col<span class="token punctuation">]</span> <span class="token operator">-</span> a <span class="token operator">*</span> e</pre></td></tr><tr><td data-num="84"></td><td><pre>        den <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre>        u <span class="token operator">=</span> num <span class="token operator">/</span> den</pre></td></tr><tr><td data-num="87"></td><td><pre>        H <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        H<span class="token punctuation">[</span>col<span class="token punctuation">:</span><span class="token punctuation">,</span> col<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token punctuation">(</span>cols <span class="token operator">-</span> col<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>u<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        R <span class="token operator">=</span> H<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>R<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>        Q <span class="token operator">=</span> Q<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>H<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token keyword">return</span> Q<span class="token punctuation">,</span> R</pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token keyword">def</span> <span class="token function">QR_GivenRot</span><span class="token punctuation">(</span>mat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    rows<span class="token punctuation">,</span> cols <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre>    R <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    Q <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre>    <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>col <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> rows<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="103"></td><td><pre>            <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>R<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-6</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="104"></td><td><pre>                <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre>            f <span class="token operator">=</span> R<span class="token punctuation">[</span>col<span class="token punctuation">,</span> col<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            s <span class="token operator">=</span> R<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="108"></td><td><pre>            den <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>f <span class="token operator">*</span> f <span class="token operator">+</span> s <span class="token operator">*</span> s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre>            c <span class="token operator">=</span> f <span class="token operator">/</span> den</pre></td></tr><tr><td data-num="110"></td><td><pre>            s <span class="token operator">=</span> s <span class="token operator">/</span> den</pre></td></tr><tr><td data-num="111"></td><td><pre></pre></td></tr><tr><td data-num="112"></td><td><pre>            T <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>rows<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            T<span class="token punctuation">[</span>col<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">,</span> T<span class="token punctuation">[</span>row<span class="token punctuation">,</span> row<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">,</span> c</pre></td></tr><tr><td data-num="114"></td><td><pre>            T<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">,</span> T<span class="token punctuation">[</span>col<span class="token punctuation">,</span> row<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> s</pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre>            R <span class="token operator">=</span> T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>R<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="117"></td><td><pre></pre></td></tr><tr><td data-num="118"></td><td><pre>            Q <span class="token operator">=</span> T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>Q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre>    <span class="token keyword">return</span> Q<span class="token punctuation">.</span>T<span class="token punctuation">,</span> R</pre></td></tr><tr><td data-num="121"></td><td><pre></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token comment"># ---------------------------------------</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token keyword">def</span> <span class="token function">QR_Basic</span><span class="token punctuation">(</span>mat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="124"></td><td><pre>    eig <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="125"></td><td><pre></pre></td></tr><tr><td data-num="126"></td><td><pre>    rows<span class="token punctuation">,</span> cols <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="127"></td><td><pre>    eigV <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="128"></td><td><pre>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="129"></td><td><pre>        q<span class="token punctuation">,</span> r <span class="token operator">=</span> QR_HouseHolder<span class="token punctuation">(</span>eig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="130"></td><td><pre>        eig <span class="token operator">=</span> r<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="131"></td><td><pre>        eigV <span class="token operator">=</span> eigV<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="132"></td><td><pre></pre></td></tr><tr><td data-num="133"></td><td><pre>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>eig<span class="token punctuation">)</span><span class="token punctuation">,</span> eigV</pre></td></tr><tr><td data-num="134"></td><td><pre></pre></td></tr><tr><td data-num="135"></td><td><pre><span class="token comment"># ---------------------------------------</span></pre></td></tr><tr><td data-num="136"></td><td><pre><span class="token keyword">def</span> <span class="token function">QR_Heisenberg</span><span class="token punctuation">(</span>mat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="137"></td><td><pre>    rows<span class="token punctuation">,</span> cols <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="138"></td><td><pre>    Hsbg <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="139"></td><td><pre></pre></td></tr><tr><td data-num="140"></td><td><pre>    eigv <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="141"></td><td><pre>    <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="142"></td><td><pre>        array <span class="token operator">=</span> mat<span class="token punctuation">[</span>row<span class="token punctuation">:</span><span class="token punctuation">,</span> row <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="143"></td><td><pre></pre></td></tr><tr><td data-num="144"></td><td><pre>        <span class="token comment"># householder</span></pre></td></tr><tr><td data-num="145"></td><td><pre>        a <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>array<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre>        e <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> rows <span class="token operator">-</span> row<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="148"></td><td><pre>        e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span></pre></td></tr><tr><td data-num="149"></td><td><pre>        num <span class="token operator">=</span> array <span class="token operator">-</span> a <span class="token operator">*</span> e</pre></td></tr><tr><td data-num="150"></td><td><pre>        u <span class="token operator">=</span> num <span class="token operator">/</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="151"></td><td><pre></pre></td></tr><tr><td data-num="152"></td><td><pre>        H <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>rows <span class="token operator">-</span> row<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>u<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="153"></td><td><pre></pre></td></tr><tr><td data-num="154"></td><td><pre>        <span class="token comment"># Hsbg</span></pre></td></tr><tr><td data-num="155"></td><td><pre>        T <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>rows<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="156"></td><td><pre>        T<span class="token punctuation">[</span>row<span class="token punctuation">:</span><span class="token punctuation">,</span> row<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> H</pre></td></tr><tr><td data-num="157"></td><td><pre></pre></td></tr><tr><td data-num="158"></td><td><pre>        Hsbg <span class="token operator">=</span> T<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>Hsbg<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>T<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="159"></td><td><pre>        eigv <span class="token operator">=</span> eigv<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>T<span class="token punctuation">.</span>T<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="160"></td><td><pre></pre></td></tr><tr><td data-num="161"></td><td><pre>    eigv <span class="token operator">=</span> eigv<span class="token punctuation">.</span>T</pre></td></tr><tr><td data-num="162"></td><td><pre>    <span class="token comment"># Given</span></pre></td></tr><tr><td data-num="163"></td><td><pre>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="164"></td><td><pre>        q<span class="token punctuation">,</span> r <span class="token operator">=</span> QR_GivenRot<span class="token punctuation">(</span>Hsbg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="165"></td><td><pre>        Hsbg <span class="token operator">=</span> r<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="166"></td><td><pre>        eigv <span class="token operator">=</span> eigv<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="167"></td><td><pre>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>Hsbg<span class="token punctuation">)</span><span class="token punctuation">,</span> eigv</pre></td></tr><tr><td data-num="168"></td><td><pre></pre></td></tr><tr><td data-num="169"></td><td><pre><span class="token comment"># -----------------------------</span></pre></td></tr><tr><td data-num="170"></td><td><pre><span class="token keyword">def</span> <span class="token function">Jacobi_Basic</span><span class="token punctuation">(</span>mat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="171"></td><td><pre>    rows<span class="token punctuation">,</span> cols <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="172"></td><td><pre></pre></td></tr><tr><td data-num="173"></td><td><pre>    eig <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="174"></td><td><pre>    eigV <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="175"></td><td><pre></pre></td></tr><tr><td data-num="176"></td><td><pre>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="177"></td><td><pre>        maxRow<span class="token punctuation">,</span> maxCol <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="178"></td><td><pre>        maxValue <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="179"></td><td><pre>        <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="180"></td><td><pre>            <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cols<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="181"></td><td><pre>                <span class="token keyword">if</span> row <span class="token operator">==</span> col<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="182"></td><td><pre>                    <span class="token keyword">continue</span></pre></td></tr><tr><td data-num="183"></td><td><pre>                <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>eig<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> maxValue<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="184"></td><td><pre>                    maxValue <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>eig<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="185"></td><td><pre>                    maxRow <span class="token operator">=</span> row</pre></td></tr><tr><td data-num="186"></td><td><pre>                    maxCol <span class="token operator">=</span> col</pre></td></tr><tr><td data-num="187"></td><td><pre>        a <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="188"></td><td><pre>        <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>eig<span class="token punctuation">[</span>maxRow<span class="token punctuation">,</span> maxRow<span class="token punctuation">]</span> <span class="token operator">-</span> eig<span class="token punctuation">[</span>maxCol<span class="token punctuation">,</span> maxCol<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1e-5</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="189"></td><td><pre>            a <span class="token operator">=</span> <span class="token number">0.25</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi</pre></td></tr><tr><td data-num="190"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="191"></td><td><pre>            a <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>arctan<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> eig<span class="token punctuation">[</span>maxRow<span class="token punctuation">,</span> maxCol<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>eig<span class="token punctuation">[</span>maxRow<span class="token punctuation">,</span> maxRow<span class="token punctuation">]</span> <span class="token operator">-</span> eig<span class="token punctuation">[</span>maxCol<span class="token punctuation">,</span> maxCol<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="192"></td><td><pre></pre></td></tr><tr><td data-num="193"></td><td><pre>        P <span class="token operator">=</span> np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>rows<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="194"></td><td><pre>        P<span class="token punctuation">[</span>maxRow<span class="token punctuation">,</span> maxRow<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="195"></td><td><pre>        P<span class="token punctuation">[</span>maxCol<span class="token punctuation">,</span> maxCol<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="196"></td><td><pre>        P<span class="token punctuation">[</span>maxRow<span class="token punctuation">,</span> maxCol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="197"></td><td><pre>        P<span class="token punctuation">[</span>maxCol<span class="token punctuation">,</span> maxRow<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="198"></td><td><pre>        eig <span class="token operator">=</span> P<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>eig<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>P<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="199"></td><td><pre>        eigV <span class="token operator">=</span> eigV<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>P<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="200"></td><td><pre></pre></td></tr><tr><td data-num="201"></td><td><pre>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span>eig<span class="token punctuation">)</span><span class="token punctuation">,</span> eigV</pre></td></tr><tr><td data-num="202"></td><td><pre></pre></td></tr><tr><td data-num="203"></td><td><pre><span class="token comment"># ----------------</span></pre></td></tr><tr><td data-num="204"></td><td><pre><span class="token keyword">def</span> <span class="token function">SortEig</span><span class="token punctuation">(</span>eig<span class="token punctuation">,</span> eigV<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="205"></td><td><pre>    e <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>eig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="206"></td><td><pre>    v <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>eigV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="207"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="208"></td><td><pre>    indices <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="209"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="210"></td><td><pre>    e <span class="token operator">=</span> np<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="211"></td><td><pre></pre></td></tr><tr><td data-num="212"></td><td><pre>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="213"></td><td><pre>        v<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> eigV<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="214"></td><td><pre></pre></td></tr><tr><td data-num="215"></td><td><pre>    <span class="token keyword">return</span> e<span class="token punctuation">,</span> v</pre></td></tr><tr><td data-num="216"></td><td><pre></pre></td></tr><tr><td data-num="217"></td><td><pre><span class="token keyword">def</span> <span class="token function">SVD_Solver</span><span class="token punctuation">(</span>mat<span class="token punctuation">,</span> Func<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="218"></td><td><pre>    aTa <span class="token operator">=</span> mat<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="219"></td><td><pre>    aaT <span class="token operator">=</span> mat<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="220"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Ata:</span><span class="token interpolation"><span class="token punctuation">&#123;</span> aTa<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="221"></td><td><pre>    eig<span class="token punctuation">,</span> eigv <span class="token operator">=</span> Func<span class="token punctuation">(</span>aTa<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="222"></td><td><pre></pre></td></tr><tr><td data-num="223"></td><td><pre>    eig<span class="token punctuation">,</span> eigv <span class="token operator">=</span> SortEig<span class="token punctuation">(</span>eig<span class="token punctuation">,</span> eigv<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="224"></td><td><pre></pre></td></tr><tr><td data-num="225"></td><td><pre>    rows<span class="token punctuation">,</span> cols <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="226"></td><td><pre>    U <span class="token operator">=</span> eigv</pre></td></tr><tr><td data-num="227"></td><td><pre>    S <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="228"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="229"></td><td><pre>        S<span class="token punctuation">[</span>i<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> eig<span class="token punctuation">[</span>i<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="230"></td><td><pre></pre></td></tr><tr><td data-num="231"></td><td><pre>    eig<span class="token punctuation">,</span> eigv <span class="token operator">=</span> Func<span class="token punctuation">(</span>aaT<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="232"></td><td><pre>    eig<span class="token punctuation">,</span> eigv <span class="token operator">=</span> SortEig<span class="token punctuation">(</span>eig<span class="token punctuation">,</span> eigv<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="233"></td><td><pre>    V <span class="token operator">=</span> eigv</pre></td></tr><tr><td data-num="234"></td><td><pre></pre></td></tr><tr><td data-num="235"></td><td><pre>    <span class="token keyword">return</span> U<span class="token punctuation">,</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">,</span> V</pre></td></tr><tr><td data-num="236"></td><td><pre></pre></td></tr><tr><td data-num="237"></td><td><pre><span class="token keyword">def</span> <span class="token function">SVD1</span><span class="token punctuation">(</span>mat<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">,</span> Method<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="238"></td><td><pre>    <span class="token comment"># Method: 0: QR_Basic, 1:QR_Heisenberg, 2:Jacobi_Basic</span></pre></td></tr><tr><td data-num="239"></td><td><pre>    U<span class="token punctuation">,</span> S<span class="token punctuation">,</span> V <span class="token operator">=</span> SVD_Solver<span class="token punctuation">(</span>mat<span class="token punctuation">,</span> Jacobi_Basic<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="240"></td><td><pre></pre></td></tr><tr><td data-num="241"></td><td><pre>    <span class="token keyword">return</span> U<span class="token punctuation">,</span> S<span class="token punctuation">,</span> V</pre></td></tr><tr><td data-num="242"></td><td><pre></pre></td></tr><tr><td data-num="243"></td><td><pre>mat <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="244"></td><td><pre>                <span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="245"></td><td><pre>                <span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="246"></td><td><pre></pre></td></tr><tr><td data-num="247"></td><td><pre>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="248"></td><td><pre></pre></td></tr><tr><td data-num="249"></td><td><pre>end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="250"></td><td><pre>usetime <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="251"></td><td><pre><span class="token comment"># print(f"Method QR_Basic use: &#123;usetime&#125; " )</span></pre></td></tr><tr><td data-num="252"></td><td><pre><span class="token comment"># print(u)</span></pre></td></tr><tr><td data-num="253"></td><td><pre><span class="token comment"># print(s)</span></pre></td></tr><tr><td data-num="254"></td><td><pre><span class="token comment"># print(v)</span></pre></td></tr><tr><td data-num="255"></td><td><pre><span class="token comment"># print("\n")</span></pre></td></tr><tr><td data-num="256"></td><td><pre></pre></td></tr><tr><td data-num="257"></td><td><pre>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="258"></td><td><pre>u<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v <span class="token operator">=</span> svd<span class="token punctuation">(</span>mat<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="259"></td><td><pre>end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="260"></td><td><pre>usetime <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="261"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Method Jacobi_Basic use: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>usetime<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="262"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="263"></td><td><pre><span class="token comment"># print(s)</span></pre></td></tr><tr><td data-num="264"></td><td><pre><span class="token comment"># print(v)</span></pre></td></tr><tr><td data-num="265"></td><td><pre><span class="token comment"># print("\n")</span></pre></td></tr><tr><td data-num="266"></td><td><pre></pre></td></tr><tr><td data-num="267"></td><td><pre>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="268"></td><td><pre>u<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>svd<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token comment">#SVD(mat, 0)</span></pre></td></tr><tr><td data-num="269"></td><td><pre>end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>perf_counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="270"></td><td><pre>usetime <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="271"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Method Real use: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>usetime<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="272"></td><td><pre></pre></td></tr><tr><td data-num="273"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="274"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="275"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="276"></td><td><pre><span class="token comment"># print("\n")</span></pre></td></tr></table></figure><p>其中这段代码最快是 jacobi 算法</p>
